{% extends "layout.html" %}

{% block script %}
<script>
window.onload = function () {

var chart = new CanvasJS.Chart("chartContainer", {
	animationEnabled: true,
	height: 500,
	zoomEnabled: true,
	title:{
		text: "Weight of Trash Clean Up vs Total Hours Spent",
		fontSize: 30
	},
	axisX: {
		title:"Time (hrs)",
		titleFontSize: 20,
		labelFontSize: 16,
		minimum: 0
	},
	axisY:{
		title: "Weight of Trash (lbs)",
		includeZero: true,
		titleFontSize: 20,
		labelFontSize: 16
		<!--valueFormatString: "$#,##0k" -->
	},
	data: [{
		type: "scatter",
		toolTipContent: "<span style=\"color:#4F81BC \"><b>{name}</b></span><br/><b> Time: </b> {x} hrs<br/><b> Weight of Trash </b></span> {y} lbs",
		name: "1 Person",
		indexLabelFontSize: 16,
		showInLegend: true,
		dataPoints: [
			{{ chart_data }}
		]
	},
	{
		type: "scatter",
		name: "2 People",
		showInLegend: true, 
		indexLabelFontSize: 16,
		toolTipContent: "<span style=\"color:#4F81BC \"><b>{name}</b></span><br/><b> Time: </b> {x} hrs<br/><b> Weight of Trash </b></span> {y} lbs",
		dataPoints: [
			{ x: 19, y: 200 },
			{ x: 27, y: 300 },
			{ x: 35, y: 330 },
			{ x: 32, y: 190 },
			{ x: 29, y: 189 },
			{ x: 22, y: 150 },
			{ x: 27, y: 200 },
			{ x: 26, y: 190 },
			{ x: 24, y: 225 },
			{ x: 33, y: 330 },
			{ x: 34, y: 250 },
			{ x: 30, y: 120 },
			{ x: 37, y: 153 },
			{ x: 24, y: 196 }
		]
	}]
});
chart.render();
calculateTrendLine(chart);
    function calculateTrendLine(chart){
        var a, b, c, d, e, slope, yIntercept;
        var xSum = 0, ySum = 0, xySum = 0, xSquare = 0, dpsLength = chart.data[0].dataPoints.length;
        for(var i = 0; i < dpsLength; i++)
            xySum += (chart.data[0].dataPoints[i].x * chart.data[0].dataPoints[i].y)
        a = xySum * dpsLength;

        for(var i = 0; i < dpsLength; i++){
            xSum += chart.data[0].dataPoints[i].x;
            ySum += chart.data[0].dataPoints[i].y;
        }
        b = xSum * ySum;

        for(var i = 0; i < dpsLength; i++)
            xSquare += Math.pow(chart.data[0].dataPoints[i].x, 2);
        c = dpsLength * xSquare;

        d = Math.pow(xSum, 2);
        slope = (a-b)/(c-d);
        e = slope * xSum;
        yIntercept = (ySum - e) / dpsLength;

        var startPoint = getTrendLinePoint(chart.data[0].dataPoints[0].x, slope, yIntercept);
        var endPoint = getTrendLinePoint(chart.data[0].dataPoints[dpsLength-1].x, slope, yIntercept);

        chart.addTo("data",{
            type: "line", //Line series showing trend
            markerSize: 0,
            dataPoints: [startPoint, endPoint]
        });
    }

    function getTrendLinePoint(x, slope, intercept){
        return {x: x, y: ((slope * x) + intercept)};
    }
}
</script>
{% endblock %}

{% block title %}
Statistics
{% endblock %}

{% block content %}
        <div id="blue-bg">
          <table id="chart">
            <caption id="caption">WATERSHED BRIGADE CUMALATIVE CLEAN-UP CHART 2021</caption>
            <tr id="heading_gradient">
              <th id="month_heading" class="chart_headings">MONTH</th>
              <th class="chart_headings"># OF SITES CLEANED</th>
              <th class="chart_headings"># OF VOLUNTEERS</th>
              <th class="chart_headings">TOTAL LBS OF TRASH</th>
            </tr>
            {{ table }}
          </table>
        </div>

        <div id="chartContainer" style="height: 370px; width: 100%;"></div>
        <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
{% endblock %}
